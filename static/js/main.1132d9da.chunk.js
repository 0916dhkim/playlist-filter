(this["webpackJsonpspotify-filter"]=this["webpackJsonpspotify-filter"]||[]).push([[0],{160:function(e,t,n){e.exports={container:"RangeInput_container__1sXvq"}},164:function(e,t,n){e.exports={container:"Playlists_container__uSOqU"}},169:function(e,t,n){e.exports=n(293)},170:function(e,t,n){},193:function(e,t){},195:function(e,t){},205:function(e,t){},207:function(e,t){},234:function(e,t){},235:function(e,t){},240:function(e,t){},242:function(e,t){},266:function(e,t){},293:function(e,t,n){"use strict";n.r(t);n(170),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var a=n(322),r=n(321),c=n(0),o=n.n(c),u=n(7),s=n.n(u),i=n(15),l=n(24),p=n.n(l),f=n(158),m=n.n(f),d="7a3bed1acbc948829fdb043e52b845b8",h="https://accounts.spotify.com/api/token",E="https://api.spotify.com/v1",v=["playlist-read-private","playlist-modify-private","playlist-modify-public"].join(" ");function y(){return window.location.protocol+"//"+window.location.host+window.location.pathname}function b(){var e=new Uint32Array(28);return window.crypto.getRandomValues(e),Array.from(e,(function(e){return("0"+e.toString(16)).substr(-2)})).join("")}function k(){return _.apply(this,arguments)}function _(){return(_=Object(i.a)(s.a.mark((function e(){var t,n,a,r,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=b(),localStorage.setItem("pkce-state",t),n=m()(),a=n.code_verifier,r=n.code_challenge,localStorage.setItem("pkce-code-verifier",a),(c=new URL("https://accounts.spotify.com/authorize")).searchParams.append("response_type","code"),c.searchParams.append("client_id",d),c.searchParams.append("state",t),c.searchParams.append("scope",v),c.searchParams.append("redirect_uri",y()),c.searchParams.append("code_challenge",r),c.searchParams.append("code_challenge_method","S256"),window.location.assign(c.toString());case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(){return(g=Object(i.a)(s.a.mark((function e(){var t,n,a,r,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new URL(window.location.href).searchParams,n=t.get("code"),a=t.get("state"),!n){e.next=18;break}if(localStorage.getItem("pkce-state")===a){e.next=6;break}throw new Error("Invalid state returned from auth server.");case 6:if(r=localStorage.getItem("pkce-code-verifier")){e.next=9;break}throw new Error("Missing local code verifier.");case 9:localStorage.removeItem("pkce-state"),localStorage.removeItem("pkce-code-verifier"),(c=new URLSearchParams).append("client_id",d),c.append("grant_type","authorization_code"),c.append("code",n),c.append("redirect_uri",y()),c.append("code_verifier",r),p.a.post(h,c.toString(),{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then((function(e){localStorage.setItem("access-token",e.data.access_token),localStorage.setItem("access-token-expiry",(Date.now()+1e3*parseFloat(e.data.expires_in)).toString()),localStorage.setItem("refresh-token",e.data.refresh_token)})).catch((function(e){console.error(e),alert("Login Failed.")})).finally((function(){window.location.href=y()}));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return(w=Object(i.a)(s.a.mark((function e(t){var n,a,r,c,o,u,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new URLSearchParams).append("grant_type","refresh_token"),n.append("refresh_token",t),n.append("client_id",d),e.next=6,p.a.post(h,n.toString(),{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}});case 6:if(a=e.sent,r=[a.data.access_token,a.data.refresh_token,a.data.expires_in],c=r[0],o=r[1],u=r[2],i=Date.now()+1e3*parseFloat(u),"string"===typeof c&&"string"===typeof o&&!isNaN(i)){e.next=11;break}throw new Error("Invalid response from auth server.");case 11:return localStorage.setItem("access-token",c),localStorage.setItem("access-token-expiry",i.toString()),localStorage.setItem("refresh-token",o),e.abrupt("return",{accessToken:c,accessTokenExpiry:i,refreshToken:o});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T=n(9),O=n(319),S=n(21),x=n(69),j=n(312),I=n(295),A=n(310),N=n(323),R=n(160),P=n.n(R);var F=function(e){var t=e.label,n=e.lowerLimit,a=e.upperLimit,r=e.step,c=e.minValue,u=e.maxValue,s=e.setMinValue,i=e.setMaxValue,l=[{value:n,label:n},{value:a,label:a}];return o.a.createElement(A.a,{className:P.a.container},o.a.createElement("h4",null,t),o.a.createElement(N.a,{min:n,max:a,step:r,marks:l,value:[c,u],valueLabelDisplay:"auto",onChange:function(e,t){if("number"!==typeof t){var n=Object(x.a)(t,2),a=n[0],r=n[1];s(a),i(r)}}}))},C=n(54),M=["duration_ms","key","mode","time_signature","acousticness","danceability","energy","instrumentalness","liveness","loudness","speechiness","valence","tempo"];function U(e,t){return e.filter((function(e){var n,a=Object(C.a)(M);try{for(a.s();!(n=a.n()).done;){var r=n.value;if(e[r]<t[r][0]||e[r]>t[r][1])return!1}}catch(c){a.e(c)}finally{a.f()}return!0}))}var L=n(93),G=n.n(L);function D(e){var t=e.feature,n=e.range,a=e.dispatch,r=Object(c.useMemo)((function(){var e=t.replace("_"," ");return e[0].toUpperCase()+e.slice(1)}),[t]);return o.a.createElement(F,{label:r,lowerLimit:0,upperLimit:1,step:.01,minValue:n[0],maxValue:n[1],setMinValue:function(e){return a({type:"SET_AUDIO_FEATURE_MIN",feature:t,value:e})},setMaxValue:function(e){return a({type:"SET_AUDIO_FEATURE_MAX",feature:t,value:e})}})}var V=["acousticness","danceability","energy","instrumentalness","liveness","speechiness","valence"];var X=function(){var e=Object(T.c)((function(e){return e.audioFeatureRange})),t=Object(T.c)((function(e){return e.tracks})),n=Object(T.b)(),a=Object(c.useMemo)((function(){return t.map((function(e){return e.tempo})).reduce((function(e,t){return[Math.min(e[0],Math.floor(t)),Math.max(e[1],Math.ceil(t))]}),[1/0,-1/0])}),[t]),r=Object(x.a)(a,2),u=r[0],s=r[1];return o.a.createElement("div",null,o.a.createElement("div",{className:G.a.grid},o.a.createElement(F,{label:"Tempo (BPM)",lowerLimit:u,upperLimit:s,step:1,minValue:e.tempo[0],maxValue:Math.min(e.tempo[1],s),setMinValue:function(e){return n({type:"SET_AUDIO_FEATURE_MIN",feature:"tempo",value:e})},setMaxValue:function(e){return n({type:"SET_AUDIO_FEATURE_MAX",feature:"tempo",value:e})}}),V.map((function(t){return o.a.createElement(D,{key:t,feature:t,dispatch:n,range:e[t]})}))),o.a.createElement(j.a,{className:G.a.buttongroup,variant:"contained",color:"primary"},o.a.createElement(I.a,{onClick:function(){return n({type:"RESET_AUDIO_FEATURE_RANGE"})}},"Reset Filters"),o.a.createElement(I.a,{onClick:function(){n({type:"GO_TO_EXPORT_PAGE",tracks:U(t,e).map((function(e){return Object(S.a)(Object(S.a)({},e),{},{type:"track"})}))})}},"Export Tracks")))};function B(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,n=0,a=[];e.length>n;)a.push(e.slice(n,n+t)),n+=t;return a}function K(e){return new Promise((function(t){return setTimeout(t,e)}))}function H(e){return{Authorization:"Bearer ".concat(e)}}function W(e){return Y.apply(this,arguments)}function Y(){return(Y=Object(i.a)(s.a.mark((function e(t){var n,a,r,c,o=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=o.length>1&&void 0!==o[1]?o[1]:3,a=0;case 2:if(!(a<n)){e.next=17;break}return e.next=5,p()(t);case 5:if(r=e.sent,2!==Math.floor(r.status/100)){e.next=8;break}return e.abrupt("return",r.data);case 8:if(429!==r.status){e.next=14;break}if(c=parseFloat(r.headers["retry-after"]),!isNaN(c)){e.next=12;break}throw new Error("Status code 429 but missing retry-after header.");case 12:return e.next=14,K(1e3*c);case 14:a++,e.next=2;break;case 17:throw new Error("Failed to get response after ".concat(n," retries."));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e,t,n){return z.apply(this,arguments)}function z(){return(z=Object(i.a)(s.a.mark((function e(t,n,a){var r,c,o,u,i,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t,c=[];case 2:if(!r){e.next=11;break}return e.next=5,W({method:"GET",url:r,headers:H(n),cancelToken:a});case 5:o=e.sent,u=Object(C.a)(o.items);try{for(u.s();!(i=u.n()).done;)l=i.value,c.push(l)}catch(s){u.e(s)}finally{u.f()}r=o.next,e.next=2;break;case 11:return e.abrupt("return",c);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e,t,n){return Z.apply(this,arguments)}function Z(){return(Z=Object(i.a)(s.a.mark((function e(t,n,a){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",W({method:"GET",url:t,headers:H(n),cancelToken:a}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t){return Q.apply(this,arguments)}function Q(){return(Q=Object(i.a)(s.a.mark((function e(t,n){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="".concat(E,"/me"),e.abrupt("return",J(a,t,n));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(){return(ee=Object(i.a)(s.a.mark((function e(t,n){var a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$(t,n);case 2:return a=e.sent,r="".concat(E,"/users/").concat(a.id,"/playlists"),e.abrupt("return",q(r,t,n));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(){return(te=Object(i.a)(s.a.mark((function e(t,n,a){var r,c,o,u,i,l,p,f,m,d,h,v;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(E,"/playlists/").concat(t,"/tracks"),e.next=3,q(r,n,a);case 3:c=e.sent,o=B(c,40),u=[],i=Object(C.a)(o),e.prev=7,i.s();case 9:if((l=i.n()).done){e.next=20;break}return p=l.value,f=p.map((function(e){return e.track.id})),m="".concat(E,"/audio-features/?ids=").concat(f.join(",")),e.next=15,J(m,n,a);case 15:for(d=e.sent,h=d.audio_features,v=0;v<p.length;v++)u.push(Object(S.a)(Object(S.a)({},p[v].track),h[v]));case 18:e.next=9;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(7),i.e(e.t0);case 25:return e.prev=25,i.f(),e.finish(25);case 28:return e.abrupt("return",u);case 29:case"end":return e.stop()}}),e,null,[[7,22,25,28]])})))).apply(this,arguments)}function ne(e,t,n,a){return ae.apply(this,arguments)}function ae(){return(ae=Object(i.a)(s.a.mark((function e(t,n,a,r){var c,o,u,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length>100)){e.next=2;break}throw new Error("Cannot add more than 100 items at a time.");case 2:return e.next=4,$(a,r);case 4:return c=e.sent,o="".concat(E,"/users/").concat(c.id,"/playlists"),e.next=8,W({method:"POST",url:o,headers:H(a),data:JSON.stringify({name:t,public:!1})});case 8:return u=e.sent,i="".concat(E,"/playlists/").concat(u.id,"/tracks"),e.next=12,W({method:"POST",url:i,headers:H(a),params:{uris:n.join(",")}});case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(){var e=Object(T.c)((function(e){return e.session})),t=Object(T.b)(),n=Object(c.useMemo)(Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("No session to refresh.");case 2:return t.abrupt("return",e);case 3:case"end":return t.stop()}}),t)}))),[e]);return e&&e.accessTokenExpiry-Date.now()<6e4?function(e){return w.apply(this,arguments)}(e.refreshToken).then((function(e){return t({type:"SIGN_IN",value:e}),e}),(function(e){return console.error("Failed to refresh session: ".concat(e)),t({type:"SIGN_OUT"}),n})):n}function ce(){var e=re(),t=Object(T.c)((function(e){return e.tracks})),n=Object(T.c)((function(e){return e.newPlaylistName})),a=Object(T.b)(),r=function(){var e=p.a.CancelToken.source();return Object(c.useEffect)((function(){return function(){return e.cancel()}}),[e]),e.token}();function u(){return(u=Object(i.a)(s.a.mark((function a(){var c,o;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e;case 2:return c=a.sent,o=c.accessToken,a.next=6,ne(n,t.map((function(e){return e.uri})),o,r);case 6:alert("Export Complete!");case 7:case"end":return a.stop()}}),a)})))).apply(this,arguments)}return o.a.createElement("div",null,"Export Page",o.a.createElement("p",null,"New Playlist Name"),o.a.createElement("input",{type:"text",value:n,onChange:function(e){return a({type:"SET_NEW_PLAYLIST_NAME",value:e.target.value})}}),o.a.createElement("button",{onClick:function(){return u.apply(this,arguments)}},"Export"))}function oe(){var e=Object(T.c)((function(e){return e.session})),t=Object(T.b)();return o.a.createElement("div",null,e?o.a.createElement(I.a,{variant:"outlined",color:"primary",onClick:function(){localStorage.removeItem("access-token"),localStorage.removeItem("access-token-expiry"),localStorage.removeItem("refresh-token"),t({type:"SIGN_OUT"})}},"Sign Out"):o.a.createElement(I.a,{variant:"contained",color:"primary",onClick:k},"Sign In With Spotify"))}var ue=n(313),se=n(324),ie=n(164),le=n.n(ie),pe=function(){var e=re(),t=Object(T.c)((function(e){return e.playlists})),n=Object(T.c)((function(e){return e.selectedPlaylistId})),a=Object(T.b)();function r(){return(r=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a({type:"START_FETCHING_TRACKS",playlistId:t});case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(c.useEffect)((function(){var t=p.a.CancelToken.source();return e.then((function(e){return function(e,t){return ee.apply(this,arguments)}(e.accessToken,t.token)})).then((function(e){a({type:"SET_PLAYLISTS",value:e})})).catch((function(e){p.a.isCancel(e)||console.error("Failed to fetch user playlists: ".concat(e))})),function(){return t.cancel()}}),[e,a]),Object(c.useEffect)((function(){if(n){var t=p.a.CancelToken.source();return e.then((function(e){var a=e.accessToken;return function(e,t,n){return te.apply(this,arguments)}(n,a,t.token)})).then((function(e){return a({type:"SET_TRACKS",value:e})})).catch((function(e){p.a.isCancel(e)||console.error("Failed to fetch playlist tracks: ".concat(e))})),function(){return t.cancel()}}}),[n,e,a]),o.a.createElement(A.a,{className:le.a.container},o.a.createElement(ue.a,{dense:!0},t.map((function(e){return o.a.createElement(se.a,{key:e.id,button:!0,onClick:function(){return function(e){return r.apply(this,arguments)}(e.id)}},e.name)}))))},fe=n(314),me=n(315),de=n(316),he=n(317),Ee=n(318),ve=n(94),ye=n.n(ve),be=function(){var e=Object(T.c)((function(e){return e.tracks})),t=Object(T.c)((function(e){return e.audioFeatureRange})),n=Object(c.useMemo)((function(){return new Map(e.map((function(e){return[e.id,e]})))}),[e]),a=Object(c.useMemo)((function(){return U(Array.from(n.values()),t)}),[n,t]);return o.a.createElement(A.a,{square:!0},o.a.createElement("h3",null,"Tracks (",a.length,")"),o.a.createElement(fe.a,{stickyHeader:!0,className:ye.a.table},o.a.createElement(me.a,{className:ye.a.header},o.a.createElement(de.a,null,o.a.createElement(he.a,null,"Title"),o.a.createElement(he.a,null,"Artists"),o.a.createElement(he.a,null,"Tempo"),o.a.createElement(he.a,null,"Acousticness"),o.a.createElement(he.a,null,"Danceability"),o.a.createElement(he.a,null,"Energy"),o.a.createElement(he.a,null,"Instrumentalness"),o.a.createElement(he.a,null,"Liveness"),o.a.createElement(he.a,null,"Loudness"),o.a.createElement(he.a,null,"Speechiness"),o.a.createElement(he.a,null,"Valence"))),o.a.createElement(Ee.a,null,a.map((function(e){return o.a.createElement(de.a,{key:e.id},o.a.createElement(he.a,null,e.name),o.a.createElement(he.a,null,e.artists.map((function(e){return e.name})).join(",")),o.a.createElement(he.a,null,e.tempo),o.a.createElement(he.a,null,e.acousticness),o.a.createElement(he.a,null,e.danceability),o.a.createElement(he.a,null,e.energy),o.a.createElement(he.a,null,e.instrumentalness),o.a.createElement(he.a,null,e.liveness),o.a.createElement(he.a,null,e.loudness),o.a.createElement(he.a,null,e.speechiness),o.a.createElement(he.a,null,e.valence))})))))},ke=n(95),_e=n.n(ke);function ge(){var e=Object(T.b)();Object(c.useEffect)((function(){!function(){g.apply(this,arguments)}();var t=function(){var e=localStorage.getItem("access-token"),t=localStorage.getItem("refresh-token"),n=parseFloat(localStorage.getItem("access-token-expiry")||"");return e&&t&&n?{accessToken:e,accessTokenExpiry:n,refreshToken:t}:null}();t&&e({type:"SIGN_IN",value:t})}),[e])}function we(){return o.a.createElement("div",null,o.a.createElement("h1",null,"Spotify Filter"),o.a.createElement(oe,null))}function Te(){var e=Object(T.c)((function(e){return e.tracks})),t=Object(T.c)((function(e){return e.loadingTracks}));return o.a.createElement("div",null,o.a.createElement("div",{className:_e.a.header},o.a.createElement("h1",{className:_e.a.title},"Spotify Filter"),o.a.createElement(oe,null)),o.a.createElement("div",null,e.length>0&&o.a.createElement(X,null),o.a.createElement(pe,null),t?o.a.createElement(O.a,null):o.a.createElement(be,null)))}var Oe=function(){var e=Object(T.c)((function(e){return e.page}));switch(ge(),e){case"landing":return o.a.createElement(we,null);case"personal":return o.a.createElement(Te,null);case"export":return o.a.createElement(ce,null)}},Se=n(165),xe=n(320),je=n(73),Ie=n(72),Ae=Object(Se.a)({palette:{type:"dark",primary:{main:je.a[500]},secondary:{main:Ie.a[500]}},transitions:{duration:{shortest:0,shorter:0,short:0,standard:0,complex:0,enteringScreen:0,leavingScreen:0}}});function Ne(e){return o.a.createElement(xe.a,{theme:Ae},e.children)}var Re=n(26),Pe=n.n(Re),Fe=n(61),Ce={page:"landing"},Me={duration_ms:[0,1/0],key:[0,1/0],mode:[0,1],time_signature:[0,1/0],acousticness:[0,1],danceability:[0,1],energy:[0,1],instrumentalness:[0,1],liveness:[0,1],loudness:[-1/0,1/0],speechiness:[0,1],valence:[0,1],tempo:[0,1/0]};var Ue=function(e,t){switch(t.type){case"SIGN_IN":return{page:"personal",session:t.value,playlists:[],loadingTracks:!1,tracks:[],audioFeatureRange:Me};default:return e}};function Le(e){return function(t,n){var a=Object(S.a)({},t);for(var r in e){var c=e[r];c&&(a[r]=c(t[r],n))}return a}}function Ge(e){return function(t,n){return e.hasOwnProperty(n.type)?(0,e[n.type])(t,n):t}}var De=Ge({SET_PLAYLISTS:function(e,t){return t.value}}),Ve=Ge({START_FETCHING_TRACKS:function(e,t){return t.playlistId}}),Xe=Ge({START_FETCHING_TRACKS:function(){return!0},SET_TRACKS:function(){return!1}}),Be=Ge({SET_TRACKS:function(e,t){return t.value}}),Ke=n(52),He=Le({playlists:De,selectedPlaylistId:Ve,loadingTracks:Xe,tracks:Be,audioFeatureRange:Ge({SET_AUDIO_FEATURE_MIN:function(e,t){return Object(S.a)(Object(S.a)({},e),{},Object(Ke.a)({},t.feature,[t.value,e[t.feature][1]]))},SET_AUDIO_FEATURE_MAX:function(e,t){return Object(S.a)(Object(S.a)({},e),{},Object(Ke.a)({},t.feature,[e[t.feature][0],t.value]))},RESET_AUDIO_FEATURE_RANGE:function(){return Me}})});var We=function(e,t){switch(t.type){case"SIGN_OUT":return{page:"landing"};case"GO_TO_EXPORT_PAGE":return{page:"export",tracks:t.tracks,session:e.session,newPlaylistName:""};default:return He(e,t)}},Ye=Le({newPlaylistName:Ge({SET_NEW_PLAYLIST_NAME:function(e,t){return t.value}})});var qe=Object(Fe.b)((function(e,t){if(!e)return Ce;switch(e.page){case"landing":return Ue(e,t);case"personal":return We(e,t);case"export":return function(e,t){return Ye(e,t)}(e,t)}}));Pe.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(T.a,{store:qe},o.a.createElement(a.b,{injectFirst:!0},o.a.createElement(Ne,null,o.a.createElement(r.a,null,o.a.createElement(Oe,null)))))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},93:function(e,t,n){e.exports={grid:"Controls_grid__3SsI9",buttongroup:"Controls_buttongroup__V6tDB"}},94:function(e,t,n){e.exports={table:"Tracks_table__1EeZa",header:"Tracks_header__3N9mH"}},95:function(e,t,n){e.exports={header:"App_header__2L3DO",title:"App_title__2oBiX"}}},[[169,1,2]]]);
//# sourceMappingURL=main.1132d9da.chunk.js.map