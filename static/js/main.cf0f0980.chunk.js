(this["webpackJsonpspotify-filter"]=this["webpackJsonpspotify-filter"]||[]).push([[0],{128:function(e,t,n){e.exports={container:"Controls_container__1ewYX"}},130:function(e,t,n){e.exports=n(255)},140:function(e,t,n){},162:function(e,t){},164:function(e,t){},174:function(e,t){},176:function(e,t){},203:function(e,t){},204:function(e,t){},209:function(e,t){},211:function(e,t){},235:function(e,t){},255:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(39),o=n.n(c),u=n(4),s=(n(140),n(3)),i=n.n(s),l=n(8),p=n(14),f=n.n(p),m=n(127),d=n.n(m),h="7a3bed1acbc948829fdb043e52b845b8",v="https://accounts.spotify.com/api/token",E="https://api.spotify.com/v1",y=["playlist-read-private","playlist-modify-private","playlist-modify-public"].join(" ");function b(){return window.location.protocol+"//"+window.location.host+window.location.pathname}function k(){var e=new Uint32Array(28);return window.crypto.getRandomValues(e),Array.from(e,(function(e){return("0"+e.toString(16)).substr(-2)})).join("")}function _(){return g.apply(this,arguments)}function g(){return(g=Object(l.a)(i.a.mark((function e(){var t,n,a,r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=k(),localStorage.setItem("pkce-state",t),n=d()(),a=n.code_verifier,r=n.code_challenge,localStorage.setItem("pkce-code-verifier",a),(c=new URL("https://accounts.spotify.com/authorize")).searchParams.append("response_type","code"),c.searchParams.append("client_id",h),c.searchParams.append("state",t),c.searchParams.append("scope",y),c.searchParams.append("redirect_uri",b()),c.searchParams.append("code_challenge",r),c.searchParams.append("code_challenge_method","S256"),window.location.assign(c.toString());case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(){return(w=Object(l.a)(i.a.mark((function e(){var t,n,a,r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=new URL(window.location.href).searchParams,n=t.get("code"),a=t.get("state"),!n){e.next=18;break}if(localStorage.getItem("pkce-state")===a){e.next=6;break}throw new Error("Invalid state returned from auth server.");case 6:if(r=localStorage.getItem("pkce-code-verifier")){e.next=9;break}throw new Error("Missing local code verifier.");case 9:localStorage.removeItem("pkce-state"),localStorage.removeItem("pkce-code-verifier"),(c=new URLSearchParams).append("client_id",h),c.append("grant_type","authorization_code"),c.append("code",n),c.append("redirect_uri",b()),c.append("code_verifier",r),f.a.post(v,c.toString(),{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then((function(e){localStorage.setItem("access-token",e.data.access_token),localStorage.setItem("access-token-expiry",(Date.now()+1e3*parseFloat(e.data.expires_in)).toString()),localStorage.setItem("refresh-token",e.data.refresh_token)})).catch((function(e){console.error(e),alert("Login Failed.")})).finally((function(){window.location.href=b()}));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(){return(T=Object(l.a)(i.a.mark((function e(t){var n,a,r,c,o,u,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new URLSearchParams).append("grant_type","refresh_token"),n.append("refresh_token",t),n.append("client_id",h),e.next=6,f.a.post(v,n.toString(),{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}});case 6:if(a=e.sent,r=[a.data.access_token,a.data.refresh_token,a.data.expires_in],c=r[0],o=r[1],u=r[2],s=Date.now()+1e3*parseFloat(u),"string"===typeof c&&"string"===typeof o&&!isNaN(s)){e.next=11;break}throw new Error("Invalid response from auth server.");case 11:return localStorage.setItem("access-token",c),localStorage.setItem("access-token-expiry",s.toString()),localStorage.setItem("refresh-token",o),e.abrupt("return",{accessToken:c,accessTokenExpiry:s,refreshToken:o});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(){var e=Object(u.c)((function(e){return e.session})),t=Object(u.b)();return r.a.createElement("div",null,e?r.a.createElement("button",{onClick:function(){localStorage.removeItem("access-token"),localStorage.removeItem("access-token-expiry"),localStorage.removeItem("refresh-token"),t({type:"SIGN_OUT"})}},"Sign Out"):r.a.createElement("button",{onClick:_},"Sign In With Spotify"))}var x=n(11),S=n(129),j=n(33),I=["duration_ms","key","mode","time_signature","acousticness","danceability","energy","instrumentalness","liveness","loudness","speechiness","valence","tempo"];function N(e,t){return e.filter((function(e){var n,a=Object(j.a)(I);try{for(a.s();!(n=a.n()).done;){var r=n.value;if(e[r]<t[r][0]||e[r]>t[r][1])return!1}}catch(c){a.e(c)}finally{a.f()}return!0}))}var A=n(63),R=n.n(A);var P=function(e){var t=e.label,n=e.lowerLimit,a=e.upperLimit,c=e.step,o=e.minValue,u=e.maxValue,s=e.setMinValue,i=e.setMaxValue;return r.a.createElement("fieldset",{className:R.a.fieldset},r.a.createElement("legend",null,t),r.a.createElement("div",{className:R.a.group},r.a.createElement("div",null,"Min (",o,")"),r.a.createElement("input",{type:"range",min:n,max:a,step:c,value:o,onChange:function(e){var t=parseFloat(e.target.value);Number.isNaN(t)&&(t=0),s(t)}}),r.a.createElement("div",null,"Max (",u,")"),r.a.createElement("input",{type:"range",min:n,max:a,step:c,value:u,onChange:function(e){var t=parseFloat(e.target.value);Number.isNaN(t)&&(t=0),i(t)}})))},F=n(128),C=n.n(F);function M(e){var t=e.feature,n=e.range,c=e.dispatch,o=Object(a.useMemo)((function(){var e=t.replace("_"," ");return e[0].toUpperCase()+e.slice(1)}),[t]);return r.a.createElement(P,{label:o,lowerLimit:0,upperLimit:1,step:.01,minValue:n[0],maxValue:n[1],setMinValue:function(e){return c({type:"SET_AUDIO_FEATURE_MIN",feature:t,value:e})},setMaxValue:function(e){return c({type:"SET_AUDIO_FEATURE_MAX",feature:t,value:e})}})}var U=["acousticness","danceability","energy","instrumentalness","liveness","speechiness","valence"];var L=function(){var e=Object(u.c)((function(e){return e.audioFeatureRange})),t=Object(u.c)((function(e){return e.tracks})),n=Object(u.b)(),c=Object(a.useMemo)((function(){return t.map((function(e){return e.tempo})).reduce((function(e,t){return[Math.min(e[0],Math.floor(t)),Math.max(e[1],Math.ceil(t))]}),[1/0,-1/0])}),[t]),o=Object(S.a)(c,2),s=o[0],i=o[1];return r.a.createElement("div",null,r.a.createElement("h3",null,"Controls"),r.a.createElement("div",{className:C.a.container},r.a.createElement(P,{label:"Tempo (BPM)",lowerLimit:s,upperLimit:i,step:1,minValue:e.tempo[0],maxValue:Math.min(e.tempo[1],i),setMinValue:function(e){return n({type:"SET_AUDIO_FEATURE_MIN",feature:"tempo",value:e})},setMaxValue:function(e){return n({type:"SET_AUDIO_FEATURE_MAX",feature:"tempo",value:e})}}),U.map((function(t){return r.a.createElement(M,{key:t,feature:t,dispatch:n,range:e[t]})}))),r.a.createElement("button",{onClick:function(){return n({type:"RESET_AUDIO_FEATURE_RANGE"})}},"Reset Filters"),r.a.createElement("button",{onClick:function(){n({type:"GO_TO_EXPORT_PAGE",tracks:N(t,e).map((function(e){return Object(x.a)(Object(x.a)({},e),{},{type:"track"})}))})}},"Export Tracks"))};function G(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,n=0,a=[];e.length>n;)a.push(e.slice(n,n+t)),n+=t;return a}function V(e){return new Promise((function(t){return setTimeout(t,e)}))}function D(e){return{Authorization:"Bearer ".concat(e)}}function K(e){return X.apply(this,arguments)}function X(){return(X=Object(l.a)(i.a.mark((function e(t){var n,a,r,c,o=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=o.length>1&&void 0!==o[1]?o[1]:3,a=0;case 2:if(!(a<n)){e.next=17;break}return e.next=5,f()(t);case 5:if(r=e.sent,2!==Math.floor(r.status/100)){e.next=8;break}return e.abrupt("return",r.data);case 8:if(429!==r.status){e.next=14;break}if(c=parseFloat(r.headers["retry-after"]),!isNaN(c)){e.next=12;break}throw new Error("Status code 429 but missing retry-after header.");case 12:return e.next=14,V(1e3*c);case 14:a++,e.next=2;break;case 17:throw new Error("Failed to get response after ".concat(n," retries."));case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e,t,n){return Y.apply(this,arguments)}function Y(){return(Y=Object(l.a)(i.a.mark((function e(t,n,a){var r,c,o,u,s,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t,c=[];case 2:if(!r){e.next=11;break}return e.next=5,K({method:"GET",url:r,headers:D(n),cancelToken:a});case 5:o=e.sent,u=Object(j.a)(o.items);try{for(u.s();!(s=u.n()).done;)l=s.value,c.push(l)}catch(i){u.e(i)}finally{u.f()}r=o.next,e.next=2;break;case 11:return e.abrupt("return",c);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e,t,n){return B.apply(this,arguments)}function B(){return(B=Object(l.a)(i.a.mark((function e(t,n,a){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K({method:"GET",url:t,headers:D(n),cancelToken:a}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,t){return J.apply(this,arguments)}function J(){return(J=Object(l.a)(i.a.mark((function e(t,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="".concat(E,"/me"),e.abrupt("return",z(a,t,n));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(){return(q=Object(l.a)(i.a.mark((function e(t,n){var a,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H(t,n);case 2:return a=e.sent,r="".concat(E,"/users/").concat(a.id,"/playlists"),e.abrupt("return",W(r,t,n));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(){return(Z=Object(l.a)(i.a.mark((function e(t,n,a){var r,c,o,u,s,l,p,f,m,d,h,v;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(E,"/playlists/").concat(t,"/tracks"),e.next=3,W(r,n,a);case 3:c=e.sent,o=G(c,40),u=[],s=Object(j.a)(o),e.prev=7,s.s();case 9:if((l=s.n()).done){e.next=20;break}return p=l.value,f=p.map((function(e){return e.track.id})),m="".concat(E,"/audio-features/?ids=").concat(f.join(",")),e.next=15,z(m,n,a);case 15:for(d=e.sent,h=d.audio_features,v=0;v<p.length;v++)u.push(Object(x.a)(Object(x.a)({},p[v].track),h[v]));case 18:e.next=9;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(7),s.e(e.t0);case 25:return e.prev=25,s.f(),e.finish(25);case 28:return e.abrupt("return",u);case 29:case"end":return e.stop()}}),e,null,[[7,22,25,28]])})))).apply(this,arguments)}function $(e,t,n,a){return Q.apply(this,arguments)}function Q(){return(Q=Object(l.a)(i.a.mark((function e(t,n,a,r){var c,o,u,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length>100)){e.next=2;break}throw new Error("Cannot add more than 100 items at a time.");case 2:return e.next=4,H(a,r);case 4:return c=e.sent,o="".concat(E,"/users/").concat(c.id,"/playlists"),e.next=8,K({method:"POST",url:o,headers:D(a),data:JSON.stringify({name:t,public:!1})});case 8:return u=e.sent,s="".concat(E,"/playlists/").concat(u.id,"/tracks"),e.next=12,K({method:"POST",url:s,headers:D(a),params:{uris:n.join(",")}});case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ee=n(64),te=n.n(ee);function ne(){var e=Object(u.c)((function(e){return e.session})),t=Object(u.b)(),n=Object(a.useMemo)(Object(l.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("No session to refresh.");case 2:return t.abrupt("return",e);case 3:case"end":return t.stop()}}),t)}))),[e]);return e&&e.accessTokenExpiry-Date.now()<6e4?function(e){return T.apply(this,arguments)}(e.refreshToken).then((function(e){return t({type:"SIGN_IN",value:e}),e}),(function(e){return console.error("Failed to refresh session: ".concat(e)),t({type:"SIGN_OUT"}),n})):n}var ae=function(){var e=ne(),t=Object(u.c)((function(e){return e.playlists})),n=Object(u.c)((function(e){return e.selectedPlaylistId})),c=Object(u.b)();function o(){return(o=Object(l.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c({type:"START_FETCHING_TRACKS",playlistId:t});case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(a.useEffect)((function(){var t=f.a.CancelToken.source();return e.then((function(e){return function(e,t){return q.apply(this,arguments)}(e.accessToken,t.token)})).then((function(e){c({type:"SET_PLAYLISTS",value:e})})).catch((function(e){f.a.isCancel(e)||console.error("Failed to fetch user playlists: ".concat(e))})),function(){return t.cancel()}}),[e,c]),Object(a.useEffect)((function(){if(n){var t=f.a.CancelToken.source();return e.then((function(e){var a=e.accessToken;return function(e,t,n){return Z.apply(this,arguments)}(n,a,t.token)})).then((function(e){return c({type:"SET_TRACKS",value:e})})).catch((function(e){f.a.isCancel(e)||console.error("Failed to fetch playlist tracks: ".concat(e))})),function(){return t.cancel()}}}),[n,e,c]),r.a.createElement("div",null,r.a.createElement("h3",null,"Playlists"),r.a.createElement("div",{className:te.a.container},t.map((function(e){return r.a.createElement("div",{key:e.id,className:te.a.item,onClick:function(){return function(e){return o.apply(this,arguments)}(e.id)}},e.name)}))))},re=n(42),ce=n.n(re),oe=function(){var e=Object(u.c)((function(e){return e.tracks})),t=Object(u.c)((function(e){return e.audioFeatureRange})),n=Object(a.useMemo)((function(){return new Map(e.map((function(e){return[e.id,e]})))}),[e]),c=Object(a.useMemo)((function(){return N(Array.from(n.values()),t)}),[n,t]);return r.a.createElement("div",null,r.a.createElement("h3",null,"Tracks (",c.length,")"),r.a.createElement("table",{className:ce.a.table},r.a.createElement("thead",null,r.a.createElement("tr",{className:ce.a.header},r.a.createElement("th",null,"Title"),r.a.createElement("th",null,"Artists"),r.a.createElement("th",null,"Tempo"),r.a.createElement("th",null,"Acousticness"),r.a.createElement("th",null,"Danceability"),r.a.createElement("th",null,"Energy"),r.a.createElement("th",null,"Instrumentalness"),r.a.createElement("th",null,"Liveness"),r.a.createElement("th",null,"Loudness"),r.a.createElement("th",null,"Speechiness"),r.a.createElement("th",null,"Valence"))),r.a.createElement("tbody",null,c.map((function(e){return r.a.createElement("tr",{key:e.id,className:ce.a.row},r.a.createElement("td",null,e.name),r.a.createElement("td",null,e.artists.map((function(e){return e.name})).join(",")),r.a.createElement("td",null,e.tempo),r.a.createElement("td",null,e.acousticness),r.a.createElement("td",null,e.danceability),r.a.createElement("td",null,e.energy),r.a.createElement("td",null,e.instrumentalness),r.a.createElement("td",null,e.liveness),r.a.createElement("td",null,e.loudness),r.a.createElement("td",null,e.speechiness),r.a.createElement("td",null,e.valence))})))))};function ue(){var e=ne(),t=Object(u.c)((function(e){return e.tracks})),n=Object(u.c)((function(e){return e.newPlaylistName})),c=Object(u.b)(),o=function(){var e=f.a.CancelToken.source();return Object(a.useEffect)((function(){return function(){return e.cancel()}}),[e]),e.token}();function s(){return(s=Object(l.a)(i.a.mark((function a(){var r,c;return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e;case 2:return r=a.sent,c=r.accessToken,a.next=6,$(n,t.map((function(e){return e.uri})),c,o);case 6:alert("Export Complete!");case 7:case"end":return a.stop()}}),a)})))).apply(this,arguments)}return r.a.createElement("div",null,"Export Page",r.a.createElement("p",null,"New Playlist Name"),r.a.createElement("input",{type:"text",value:n,onChange:function(e){return c({type:"SET_NEW_PLAYLIST_NAME",value:e.target.value})}}),r.a.createElement("button",{onClick:function(){return s.apply(this,arguments)}},"Export"))}function se(){var e=Object(u.b)();Object(a.useEffect)((function(){!function(){w.apply(this,arguments)}();var t=function(){var e=localStorage.getItem("access-token"),t=localStorage.getItem("refresh-token"),n=parseFloat(localStorage.getItem("access-token-expiry")||"");return e&&t&&n?{accessToken:e,accessTokenExpiry:n,refreshToken:t}:null}();t&&e({type:"SIGN_IN",value:t})}),[e])}function ie(){var e=Object(u.c)((function(e){return e.tracks})),t=Object(u.c)((function(e){return e.loadingTracks}));return r.a.createElement("div",null,e.length>0&&r.a.createElement(L,null),r.a.createElement(ae,null),t?r.a.createElement("p",null,"Loading..."):r.a.createElement(oe,null))}var le=function(){var e=Object(u.c)((function(e){return e.page}));switch(se(),e){case"landing":return r.a.createElement("div",null,r.a.createElement("h1",null,"Spotify Filter"),r.a.createElement(O,null));case"personal":return r.a.createElement("div",null,r.a.createElement("h1",null,"Spotify Filter"),r.a.createElement(O,null),r.a.createElement(ie,null));case"export":return r.a.createElement(ue,null)}},pe=n(40),fe={page:"landing"},me={duration_ms:[0,1/0],key:[0,1/0],mode:[0,1],time_signature:[0,1/0],acousticness:[0,1],danceability:[0,1],energy:[0,1],instrumentalness:[0,1],liveness:[0,1],loudness:[-1/0,1/0],speechiness:[0,1],valence:[0,1],tempo:[0,1/0]};var de=function(e,t){switch(t.type){case"SIGN_IN":return{page:"personal",session:t.value,playlists:[],loadingTracks:!1,tracks:[],audioFeatureRange:me};default:return e}};function he(e){return function(t,n){var a=Object(x.a)({},t);for(var r in e){var c=e[r];c&&(a[r]=c(t[r],n))}return a}}function ve(e){return function(t,n){return e.hasOwnProperty(n.type)?(0,e[n.type])(t,n):t}}var Ee=ve({SET_PLAYLISTS:function(e,t){return t.value}}),ye=ve({START_FETCHING_TRACKS:function(e,t){return t.playlistId}}),be=ve({START_FETCHING_TRACKS:function(){return!0},SET_TRACKS:function(){return!1}}),ke=ve({SET_TRACKS:function(e,t){return t.value}}),_e=n(32),ge=he({playlists:Ee,selectedPlaylistId:ye,loadingTracks:be,tracks:ke,audioFeatureRange:ve({SET_AUDIO_FEATURE_MIN:function(e,t){return Object(x.a)(Object(x.a)({},e),{},Object(_e.a)({},t.feature,[t.value,e[t.feature][1]]))},SET_AUDIO_FEATURE_MAX:function(e,t){return Object(x.a)(Object(x.a)({},e),{},Object(_e.a)({},t.feature,[e[t.feature][0],t.value]))},RESET_AUDIO_FEATURE_RANGE:function(){return me}})});var we=function(e,t){switch(t.type){case"SIGN_OUT":return{page:"landing"};case"GO_TO_EXPORT_PAGE":return{page:"export",tracks:t.tracks,session:e.session,newPlaylistName:""};default:return ge(e,t)}},Te=he({newPlaylistName:ve({SET_NEW_PLAYLIST_NAME:function(e,t){return t.value}})});var Oe=Object(pe.b)((function(e,t){if(!e)return fe;switch(e.page){case"landing":return de(e,t);case"personal":return we(e,t);case"export":return function(e,t){return Te(e,t)}(e,t)}}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(u.a,{store:Oe},r.a.createElement(le,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},42:function(e,t,n){e.exports={table:"Tracks_table__3jlyv",header:"Tracks_header__3bCq6",row:"Tracks_row__z4scu",flip:"Tracks_flip__25DHE"}},63:function(e,t,n){e.exports={fieldset:"RangeInput_fieldset__a0rxP",group:"RangeInput_group__AhlvO"}},64:function(e,t,n){e.exports={container:"Playlists_container__3VFZU",item:"Playlists_item__1ar3d"}}},[[130,1,2]]]);
//# sourceMappingURL=main.cf0f0980.chunk.js.map